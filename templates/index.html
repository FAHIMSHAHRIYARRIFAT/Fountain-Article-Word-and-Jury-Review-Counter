<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>‡¶â‡¶á‡¶ï‡¶ø ‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡ßá‡¶∞ ‡¶∂‡¶¨‡ßç‡¶¶ ‡¶ó‡¶£‡¶ï</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+Bengali:wght@400;700&display=swap" rel="stylesheet">
<style>
/* ---------- Theme Variables ---------- */
:root {
  --bg: #0d1117;
  --card: #0f1720;
  --muted: #8b949e;
  --text: #c9d1d9;
  --accent: #58a6ff;
  --btnText: #041024;
  --btnWarnText: #fff;
  --success: #2ea043;
  --danger: #f85149;
  --glass: rgba(255,255,255,0.03);
  --cardGradientStart: rgba(255,255,255,0.02);
  --inputBorder: rgba(255,255,255,0.03);
}

/* ---------- Light Mode Variables ---------- */
body.light {
  --bg: #f6f8fa;
  --card: #ffffff;
  --muted: #57606a;
  --text: #111;
  --accent: #0969da;
  --btnText: #fff;
  --btnWarnText: #fff;
  --success: #2ea043;
  --danger: #d92f2f;
  --glass: rgba(0,0,0,0.03);
  --cardGradientStart: rgba(0,0,0,0.03);
  --inputBorder: rgba(0,0,0,0.1);
}

/* ---------- Global Styles ---------- */
body {
  font-family: 'Noto Serif Bengali', serif;
  background: var(--bg);
  color: var(--text);
  margin: 0;
  padding: 20px;
  display: flex;
  justify-content: center;
  flex-direction: column;
  align-items: center;
  transition: background 0.3s, color 0.3s;
}

.container {
  width: 100%;
  max-width: 1100px;
  padding: 0 10px;
}

.header {
  display: flex;
  flex-direction: column;
  gap: 12px;
  align-items: center;
  margin-bottom: 18px;
  flex-wrap: wrap;
}

.title {
  font-size: 1.5rem;
  color: var(--accent);
  margin: 0;
  text-align: center;
}

.controls {
  display: flex;
  flex-direction: column;
  gap: 10px;
  align-items: center;
  width: 100%;
}

.controls .buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: center;
  width: 100%;
}

input[type="text"] {
  background: var(--card);
  border: 1px solid var(--inputBorder);
  padding: 10px 12px;
  border-radius: 8px;
  color: var(--text);
  width: 100%;
  max-width: 400px;
  box-sizing: border-box;
}

.btn, .btn.warn {
  flex: 1;
  min-width: 150px;
  max-width: 200px;
  text-align: center;
}

.btn {
  background: var(--accent);
  color: var(--btnText);
  border: none;
  padding: 10px 12px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  transition: opacity 0.2s;
}

.btn:hover { opacity: 0.85; }

.btn.warn {
  background: var(--danger);
  color: var(--btnWarnText);
}

.copy-btn {
  background: var(--card);
  color: var(--text);
  padding: 6px 10px;
  border-radius: 8px;
  border: 1px solid var(--glass);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: opacity 0.2s;
  flex-wrap: wrap;
}

.copy-btn:hover { opacity: 0.85; }

.progress-wrap {
  height: 8px;
  background: var(--glass);
  border-radius: 999px;
  overflow: hidden;
  margin: 14px auto;      /* center horizontally */
  display: none;
  max-width: 600px;       /* optional: limit width on very large screens */
}

.progress {
  height: 100%;
  width: 0%;
  background: var(--success);
  transition: width 0.22s;
}


.card {
  background: linear-gradient(180deg, var(--cardGradientStart), transparent);
  border: 1px solid var(--glass);
  border-radius: 12px;
  padding: 14px;
  margin-top: 12px;
  width: 100%;
  overflow-x: auto;
}

.table-wrap {
  overflow-x: auto;       /* enable horizontal scrolling */
  overflow-y: hidden;     /* hide vertical scroll */
  margin-top: 12px;
  -webkit-overflow-scrolling: touch; /* smooth scroll on mobile */
}

table {
  width: 100%;
  border-collapse: collapse;
  min-width: 700px;      /* ensures table doesn‚Äôt shrink too much */
  table-layout: fixed;   /* optional: keeps column widths consistent */
}

th, td {
  padding: 10px 12px;
  text-align: center;
  border-bottom: 1px solid var(--glass);
  font-size: 0.95rem;
  white-space: nowrap;   /* prevent wrapping */
}

th {
  color: var(--muted);
  font-weight: 700;
  background: transparent;
}

td.left {
  text-align: left;
  padding-left: 12px;
}

.total-row td {
  font-weight: 700;
  color: var(--accent);
  border-top: 1px solid var(--glass);
}

.small {
  font-size: 0.86rem;
  color: var(--muted);
}

.error {
  color: var(--danger);
  margin-top: 10px;
}

.hidden { display: none; }
.input-label {
  display: block;
  max-width: 100%;
  word-break: break-word; /* allow long URLs or text to wrap */
  font-size: 1rem;
  text-align: center;
  color: var(--muted);
  margin-bottom: 6px;
}

@media(max-width: 820px) {
  .input-label { 
    font-size: 0.9rem; 
    text-align: left; 
  }
}

@media(max-width: 480px) {
  .input-label { 
    font-size: 0.85rem; 
    text-align: left; 
  }
}
#fountainCode{border: 1px solid;}
/* ---------- Theme toggle button ---------- */
#themeToggle {
  position: fixed;
  top: 10px;
  right: 10px;
  padding: 8px 12px;
  background: var(--accent);
  color: var(--btnText);
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 700;
  z-index: 999;
  transition: opacity 0.2s;
}

#themeToggle:hover { opacity: 0.85; }

/* ---------- Responsive Styles ---------- */
@media(max-width: 1024px) {
  .title { font-size: 1.3rem; }
}

@media(max-width: 820px) {
  input[type="text"] { max-width: 100%; }
  .btn, .btn.warn { min-width: 120px; max-width: 100%; }
  table { min-width: 300px; font-size: 0.9rem; }
}

@media(max-width: 480px) {
  .title { font-size: 1.1rem; }
  th, td { padding: 6px 8px; font-size: 0.85rem; }
  .controls .buttons { flex-direction: column; }
}
</style>


</head>
<body>
<button id="themeToggle">üåô / ‚òÄÔ∏è</button>

<div class="container">
  <div class="header">
    <h1 class="title">‡¶â‡¶á‡¶ï‡¶ø ‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡ßá‡¶∞ ‡¶∂‡¶¨‡ßç‡¶¶ ‡¶ó‡¶£‡¶ï</h1>
    <div class="controls">
  <label for="fountainCode" class="input-label">
    ‡¶´‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá‡¶® ‡¶á‡¶â‡¶Ü‡¶∞‡¶è‡¶≤ ‡¶è‡¶∞ ‡¶∂‡ßá‡¶∑‡ßá‡¶∞ ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® ‚Äî ‡¶Ø‡ßá‡¶Æ‡¶®: https://fountain.toolforge.org/editathons/voy25 ‡¶è‡¶á ‡¶ï‡ßç‡¶∑‡ßá‡¶§‡ßç‡¶∞‡ßá ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶π‡¶¨‡ßá voy25
  </label>
  <input id="fountainCode" type="text" aria-label="‡¶´‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá‡¶® ‡¶á‡¶â‡¶Ü‡¶∞‡¶è‡¶≤ ‡¶è‡¶∞ ‡¶∂‡ßá‡¶∑‡ßá‡¶∞ ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
  
  <div class="buttons">
    <button id="countBtn" class="btn">üìù ‡¶∂‡¶¨‡ßç‡¶¶‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶ó‡¶£‡¶®‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    <button id="juryBtn" class="btn warn">üßê ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶®‡¶æ ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶® ‡¶ó‡¶£‡¶®‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
  </div>
</div>

  </div>

  <div id="error" class="error hidden"></div>
  <div class="progress-wrap" id="progressWrap"><div class="progress" id="progressBar"></div></div>

  <div class="card hidden" id="resultCard" aria-live="polite">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div class="small" id="resultTitle">‡¶´‡¶≤‡¶æ‡¶´‡¶≤</div>
      <div>
        <button class="copy-btn" id="copyWikiBtn">üìã ‡¶â‡¶á‡¶ï‡¶ø‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      </div>
    </div>
    <div class="table-wrap" id="tableWrap"></div>
    <div id="summary" class="small" style="margin-top:10px;text-align:right;color:var(--muted)"></div>
  </div>

  <div class="card hidden" id="juryCard">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div class="small">‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶®‡¶æ ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶®</div>
      <button class="copy-btn" id="copyJuryBtn">üìã ‡¶â‡¶á‡¶ï‡¶ø‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
    <div class="table-wrap" id="juryParsedWrap"></div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

  /* ---------- Theme toggle ---------- */
  const themeToggle = document.getElementById('themeToggle');
  const userPref = localStorage.getItem('theme');

  // Apply saved theme or default dark
  if(userPref === 'light') document.body.classList.add('light');
  updateToggleText();

  themeToggle.onclick = () => {
    document.body.classList.toggle('light');
    localStorage.setItem('theme', document.body.classList.contains('light') ? 'light' : 'dark');
    updateToggleText();
  };

  function updateToggleText() {
    themeToggle.textContent = document.body.classList.contains('light') ? 'üåô' : '‚òÄÔ∏è';
  }

  /* ---------- Main JS ---------- */
  const MAX_CONCURRENT = 500;
  const fountainEndpoint = '/fetch_articles';
  const juryEndpoint = '/jury_stats';

  const fountainInput = document.getElementById('fountainCode');
  const countBtn = document.getElementById('countBtn');
  const juryBtn  = document.getElementById('juryBtn');
  const progressWrap = document.getElementById('progressWrap');
  const progressBar  = document.getElementById('progressBar');
  const resultCard = document.getElementById('resultCard');
  const tableWrap = document.getElementById('tableWrap');
  const summaryEl = document.getElementById('summary');
  const copyWikiBtn = document.getElementById('copyWikiBtn');
  const juryCard = document.getElementById('juryCard');
  const juryParsedWrap = document.getElementById('juryParsedWrap');
  const copyJuryBtn = document.getElementById('copyJuryBtn');
  const errorEl = document.getElementById('error');

  let currentWikitable = '';
  let currentJuryWikitable = '';

  /* ---------- Helpers ---------- */
  function showError(msg) { errorEl.textContent = msg; errorEl.classList.remove('hidden'); }
  function hideError() { errorEl.textContent = ''; errorEl.classList.add('hidden'); }
  function showProgress() { progressWrap.style.display='block'; progressBar.style.width='0%'; }
  function hideProgress() { progressWrap.style.display='none'; progressBar.style.width='0%'; }
  function setProgress(p) { progressBar.style.width = `${p}%`; }

  const toBn = n => String(n).replace(/\d/g, d => "‡ß¶‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ"[d]);
  const formatBn = n => { try { return Number(n).toLocaleString('bn-BD'); } catch { return toBn(n); } };
  const escapeHtml = s => String(s || '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));

  /* ---------- Event listeners ---------- */
  countBtn.addEventListener('click', () => runMode('word'));
  juryBtn.addEventListener('click', () => runMode('review'));

  /* ---------- Run mode ---------- */
  async function runMode(selectedMode) {
    hideError();
    resultCard.classList.add('hidden');
    juryCard.classList.add('hidden');
    tableWrap.innerHTML = ''; summaryEl.textContent = '';
    juryParsedWrap.innerHTML = '';
    currentWikitable = ''; currentJuryWikitable = '';
    const code = fountainInput.value.trim();
    if(!code) { showError('‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶´‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá‡¶® ‡¶ï‡ßã‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§'); return; }
    if(selectedMode === 'word') await loadArticleWordCounts(code);
    else await loadJuryStats(code);
  }

  /* ---------- Article Word Count ---------- */
  async function loadArticleWordCounts(code) {
    countBtn.disabled = juryBtn.disabled = true;
    showProgress();
    try {
      const resp = await fetch(fountainEndpoint, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({code})
      });
      const body = await resp.json();
      if(body.error) throw new Error(body.error);

      const rawArticles = body.articles || {};
      const siteUrl = body.site_url || 'bn.wikipedia.org';
      const tasks = [];

      for(const user in rawArticles) {
        const arr = rawArticles[user];
        for(const a of arr){
          const title = a.name || '';
          const status = a.status || '‡¶Ö‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£';
          const reviews = a.reviews || 0;
          if(title) tasks.push({user, title, status, reviews});
        }
      }

      if(tasks.length === 0) { showError('‡¶ï‡ßã‡¶®‡ßã ‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§'); hideProgress(); return; }
      await countArticleWords(tasks, siteUrl);

    } catch(e) { showError('‡¶°‡ßá‡¶ü‡¶æ ‡¶Ü‡¶®‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: '+e.message); hideProgress(); }
    finally { countBtn.disabled = juryBtn.disabled = false; }
  }

  async function countArticleWords(tasks, siteUrl) {
    const totals = {};
    for(const t of tasks) if(!totals[t.user]) totals[t.user] = {accepted:0, unreviewed:0, rejected:0, total:0, reviews:0};

    let idx=0, done=0;
    setProgress(0); showProgress();

    async function nextTask() { if(idx>=tasks.length) return null; return tasks[idx++]; }

    async function fetchOne(task) {
      const url = `https://${siteUrl}/w/api.php?action=parse&page=${encodeURIComponent(task.title)}&format=json&prop=text&origin=*`;
      try {
        const res = await fetch(url);
        const j = await res.json();
        if(j.error) throw new Error('Page not found');

        const htmlContent = j.parse.text['*'] || '';
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = htmlContent;

        const unwanted = [
          '.mw-empty-elt','.mw-editsection','.reference','.references',
          '.reflist','.mbox-small','.ambox','.navbox','.catlinks',
          '.noprint','.metadata','.portal','style','script','.thumbinner',
          '.listing-lastedit'
        ].join(',');
        tempDiv.querySelectorAll(unwanted).forEach(e=>e.remove());

        const content = tempDiv.textContent || '';
        let words;
        if(siteUrl.startsWith('bn.')) words = (content.match(/[\u0980-\u09FF]+/g)||[]).length;
        else words = content.split(/\s+/).filter(w=>w.length>0).length;

        totals[task.user].total += words;
        if(task.status === '‡¶ó‡ßÉ‡¶π‡ßÄ‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá') totals[task.user].accepted += words;
        else if(task.status === '‡¶ó‡ßÉ‡¶π‡ßÄ‡¶§ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø') totals[task.user].rejected += words;
        else totals[task.user].unreviewed += words;
        totals[task.user].reviews += (task.reviews || 0);

      } catch(e) { totals[task.user].reviews += (task.reviews || 0); }
      finally { done++; setProgress(Math.round((done / tasks.length)*100)); }
    }

    const concurrency = Math.min(MAX_CONCURRENT, tasks.length||1);
    const workers = Array.from({length:concurrency}, async ()=>{ while(true){ const t=await nextTask(); if(!t) break; await fetchOne(t); }});
    await Promise.all(workers);
    hideProgress();
    renderArticleTable(totals);
  }

  function renderArticleTable(totals) {
    const keys = Object.keys(totals);
    if(keys.length === 0) { resultCard.classList.add('hidden'); return; }

    resultCard.classList.remove('hidden');
    const rows = Object.entries(totals).map(([user,v])=>({user,...v})).sort((a,b)=>b.accepted - a.accepted);

    let html = '<table><thead><tr><th>#</th><th class="left">‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ</th><th>‡¶ó‡ßÉ‡¶π‡ßÄ‡¶§</th><th>‡¶Ö‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶ø‡¶§</th><th>‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</th><th>‡¶Æ‡ßã‡¶ü ‡¶∂‡¶¨‡ßç‡¶¶</th><th>‡¶Æ‡ßã‡¶ü ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶ø‡¶§ ‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß</th></tr></thead><tbody>';
    let wikitable = '{| class="wikitable sortable"\n! # !! ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ !! ‡¶ó‡ßÉ‡¶π‡ßÄ‡¶§ !! ‡¶Ö‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶ø‡¶§ !! ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ !! ‡¶Æ‡ßã‡¶ü ‡¶∂‡¶¨‡ßç‡¶¶ !! ‡¶Æ‡ßã‡¶ü ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶ø‡¶§ ‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß\n';

    let gi=1, gA=0, gU=0, gR=0, gT=0, gRev=0;
    for(const r of rows){
      html += `<tr><td>${toBn(gi)}</td><td class="left">${escapeHtml(r.user)}</td><td>${formatBn(r.accepted)}</td><td>${formatBn(r.unreviewed)}</td><td>${formatBn(r.rejected)}</td><td>${formatBn(r.total)}</td><td>${formatBn(r.reviews)}</td></tr>`;
      wikitable += `|-\n| ${toBn(gi)} || ${r.user} || ${toBn(r.accepted)} || ${toBn(r.unreviewed)} || ${toBn(r.rejected)} || ${toBn(r.total)} || ${toBn(r.reviews)}\n`;
      gA+=r.accepted; gU+=r.unreviewed; gR+=r.rejected; gT+=r.total; gRev+=r.reviews; gi++;
    }

    html += `<tr class="total-row"><td></td><td class="left">‡¶Æ‡ßã‡¶ü</td><td>${formatBn(gA)}</td><td>${formatBn(gU)}</td><td>${formatBn(gR)}</td><td>${formatBn(gT)}</td><td>${formatBn(gRev)}</td></tr></tbody></table>`;
    wikitable += `|-\n! ‡¶Æ‡ßã‡¶ü ||  || ${toBn(gA)} || ${toBn(gU)} || ${toBn(gR)} || ${toBn(gT)} || ${toBn(gRev)}\n|}`;

    tableWrap.innerHTML = html;
    summaryEl.textContent = `‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂ ‚Äî ‡¶Æ‡ßã‡¶ü ‡¶ó‡ßÉ‡¶π‡ßÄ‡¶§: ${formatBn(gA)} | ‡¶Æ‡ßã‡¶ü ‡¶Ö‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶ø‡¶§: ${formatBn(gU)} | ‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤: ${formatBn(gR)} | ‡¶Æ‡ßã‡¶ü ‡¶∂‡¶¨‡ßç‡¶¶: ${formatBn(gT)} | ‡¶Æ‡ßã‡¶ü ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶®‡¶æ: ${formatBn(gRev)}`;
    currentWikitable = wikitable;

    copyWikiBtn.onclick = ()=>{ navigator.clipboard.writeText(currentWikitable).then(()=>{ copyWikiBtn.textContent='‚úì ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá'; setTimeout(()=>copyWikiBtn.textContent='üìã ‡¶â‡¶á‡¶ï‡¶ø‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®',1400); }); };
  }

  /* ---------- Jury Stats ---------- */
  async function loadJuryStats(code) {
    countBtn.disabled = juryBtn.disabled = true;
    showProgress();
    try{
      const resp = await fetch(juryEndpoint, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({code})
      });
      const data = await resp.json();
      if(data.error) throw new Error(data.error);

      const juries = data.raw || [];
      hideProgress();
      if(juries.length === 0){ juryCard.classList.add('hidden'); return; }

      juryCard.classList.remove('hidden');
      juries.sort((a,b)=>b[1].total - a[1].total);

      let html = '<table><thead><tr><th>#</th><th class="left">‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶ï</th><th>‡¶Æ‡ßã‡¶ü</th><th>‡¶ó‡ßÉ‡¶π‡ßÄ‡¶§</th><th>‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</th></tr></thead><tbody>';
      let wikitable = '{| class="wikitable sortable"\n! # !! ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶ï !! ‡¶Æ‡ßã‡¶ü !! ‡¶ó‡ßÉ‡¶π‡ßÄ‡¶§ !! ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤\n';

      let gi=1, tTot=0, tAcc=0, tRej=0;
      for(const [j,s] of juries){
        html += `<tr><td>${toBn(gi)}</td><td class="left">${escapeHtml(j)}</td><td>${toBn(s.total)}</td><td>${toBn(s.accepted)}</td><td>${toBn(s.rejected)}</td></tr>`;
        wikitable += `|-\n| ${toBn(gi)} || ${j} || ${toBn(s.total)} || ${toBn(s.accepted)} || ${toBn(s.rejected)}\n`;
        tTot+=s.total; tAcc+=s.accepted; tRej+=s.rejected; gi++;
      }

      html += `<tr class="total-row"><td></td><td class="left">‡¶Æ‡ßã‡¶ü</td><td>${toBn(tTot)}</td><td>${toBn(tAcc)}</td><td>${toBn(tRej)}</td></tr></tbody></table>`;
      wikitable += `|-\n! ‡¶Æ‡ßã‡¶ü ||  || ${toBn(tTot)} || ${toBn(tAcc)} || ${toBn(tRej)}\n|}`;

      juryParsedWrap.innerHTML = html;
      currentJuryWikitable = wikitable;

      copyJuryBtn.onclick = ()=>{ navigator.clipboard.writeText(currentJuryWikitable).then(()=>{ copyJuryBtn.textContent='‚úì ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá'; setTimeout(()=>copyJuryBtn.textContent='üìã ‡¶â‡¶á‡¶ï‡¶ø‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®',1400); }); };

    } catch(e){ hideProgress(); showError('‡¶°‡ßá‡¶ü‡¶æ ‡¶Ü‡¶®‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: '+e.message); }
    finally { countBtn.disabled = juryBtn.disabled = false; }
  }

});
</script>
